# 쿠키(Cookie) vs 세션(Session): 서버가 나를 기억하는 법

## 들어가기 전 둘의 가장 큰 차이는?

가장 큰 차이점은 **"데이터를 어디에 저장하느냐"**입니다.

* **쿠키(Cookie):** 사용자의 **브라우저(Client)**에 저장.
* **세션(Session):** **서버(Server)**의 메모리에 저장.

---

## 쿠키 (Cookie)

서버가 사용자의 웹 브라우저에 저장하는 작은 데이터 파일(Key-Value 형태)입니다. 사용자가 사이트에 재방문할 때, 브라우저는 이 쿠키를 요청 헤더(Header)에 담아 서버로 보냅니다.

### 언제 사용할까?
보안이 크게 중요하지 않거나, 서버의 자원을 아껴야 할 때 사용합니다.
* **"오늘 하루 보지 않기"** 팝업 체크
* **"아이디 기억하기"** 체크박스
* 비로그인 장바구니 담기

### 장단점
* **장점:** 서버의 저장 공간(메모리)을 사용하지 않아 서버 부하가 적습니다.
* **단점:**
    * **보안 취약:** 브라우저에서 누구나 내용을 열어보고 조작할 수 있습니다. (비밀번호 같은 중요 정보 저장 절대 금지!)
    * **용량 제한:** 하나의 도메인당 4KB, 개수 제한이 있습니다.
    * **네트워크 트래픽:** 매 요청마다 쿠키가 같이 전송되므로 트래픽이 늘어납니다.

---

## 세션

데이터를 **서버의 메모리**에 저장하고, 브라우저에는 **'세션 ID'**라는 식별자(열쇠)만 쿠키 형태로 부여하는 방식입니다. 브라우저는 실제 데이터 대신 이 ID만 들고 다닙니다.

### 언제 사용할까?
보안이 중요한 정보를 다룰 때 사용합니다.
* **로그인 정보 유지** (사용자 식별)
* 사용자 권한 관리 (관리자 vs 일반 회원)

### 장단점
* **장점:**
    * **보안 우수:** 중요한 데이터는 서버에만 있고, 클라이언트는 알 수 없는 ID만 가지므로 안전합니다.
    * **용량 무제한:** 서버 메모리가 허용하는 한 데이터를 많이 저장할 수 있습니다.
* **단점:**
    * **서버 부하:** 접속자가 많아지면 서버 메모리를 많이 잡아먹습니다.
    * **속도:** 쿠키보다 처리 속도가 (아주 미세하게) 느릴 수 있습니다.

---

## 동작 흐름

### 1. 쿠키 동작 원리 (기본적인 상태 저장)


1.  **Client:** 웹사이트 접속 (최초 요청)
2.  **Server:** 응답 헤더(`Set-Cookie`)에 저장하고 싶은 데이터(예: `popup=done`)를 담아 보냄.
3.  **Client:** 브라우저 쿠키 저장소에 해당 데이터를 저장.
4.  **Client:** 재방문 또는 페이지 이동 시, 요청 헤더(`Cookie`)에 저장된 데이터(`popup=done`)를 자동으로 담아 보냄.
5.  **Server:** 쿠키를 읽어 상태를 확인하고 그에 맞는 처리 수행.

### 2. 세션 동작 원리 (로그인 예시)


1.  **Client:** 로그인 요청 (`user`, `pw` 전송)
2.  **Server:** 회원 확인 후, **세션 저장소에 정보를 저장**하고 고유한 **Session ID**를 생성.
3.  **Server:** 응답 헤더(`Set-Cookie`)에 **Session ID**를 담아서 보냄. (예: `JSESSIONID=1A2B3C...`)
4.  **Client:** 브라우저 쿠키 저장소에 Session ID 저장.
5.  **Client:** 다음 페이지 요청 시, 쿠키에 있는 **Session ID를 같이 보냄.**
6.  **Server:** 받은 ID로 세션 저장소를 뒤져서 "아, 아까 로그인한 철수구나!" 하고 인식.

---

## 한 눈에 보는 비교

| 구분 | 쿠키 (Cookie) | 세션 (Session) |
| :--- | :--- | :--- |
| **저장 위치** | 클라이언트 (브라우저) | 서버 (메모리) |
| **보안** | **취약** (탈취/변조 쉬움) | **우수** (서버에 데이터 존재) |
| **속도** | 빠름 (바로 참조) | 비교적 느림 (서버 조회 필요) |
| **생명 주기** | 만료 시간 설정 가능 | 브라우저 종료 시 삭제 (기본값) |
| **용량** | 작음 (4KB) | 서버 허용 범위 내 무제한 |

---

## 코드 예시 (Java Spring Boot)

### 1. 쿠키 사용
```java
// 1. 쿠키 생성 및 클라이언트로 전송 (서버 -> 클라이언트)
@GetMapping("/create-cookie")
public void createCookie(HttpServletResponse response) {
    // "id_save"라는 이름으로 "memberA" 값을 저장
    Cookie cookie = new Cookie("id_save", "memberA");
    cookie.setMaxAge(60 * 60 * 24); // 24시간 유지
    response.addCookie(cookie); // 응답 헤더에 추가
}

// 2. 쿠키 읽기 (클라이언트 -> 서버)
@GetMapping("/read-cookie")
public String readCookie(@CookieValue(name = "id_save", required = false) String savedId) {
    if (savedId == null) {
        return "저장된 아이디 없음";
    }
    return "저장된 아이디: " + savedId;
}
```

### 2. 세션 사용
```java
// 1. 로그인 성공 시 세션 생성
@PostMapping("/login")
public String login(HttpServletRequest request) {
    // 세션이 있으면 가져오고, 없으면 새로 생성(true)
    HttpSession session = request.getSession(true);
    
    // 세션에 로그인 회원 정보 보관 (메모리에 저장됨)
    session.setAttribute("loginMember", "철수");
    return "로그인 성공";
}

// 2. 로그인 체크 (세션 조회)
@GetMapping("/home")
public String home(HttpServletRequest request) {
    // 세션이 없으면 null 반환 (새로 생성 안 함)
    HttpSession session = request.getSession(false);
    
    if (session == null || session.getAttribute("loginMember") == null) {
        return "로그인 필요";
    }
    
    return "환영합니다, " + session.getAttribute("loginMember") + "님!";
}

// 3. 로그아웃 (세션 제거)
@PostMapping("/logout")
public void logout(HttpServletRequest request) {
    HttpSession session = request.getSession(false);
    if (session != null) {
        session.invalidate(); // 세션 날려버리기
    }
}
```

---

## 결론
**"세션은 쿠키를 사용한다."**

세션도 결국 클라이언트를 식별하기 위해 **Session ID를 쿠키에 담아서** 주고받습니다. 즉, 완전히 별개의 기술이 아니라 상호 보완적인 관계입니다.

* **보안이 중요하다?** -> 무조건 **세션**
* **서버 자원이 아깝거나, 단순 편의 기능이다?** -> **쿠키**

최근에는 앱(App) 환경이나 서버의 확장성을 위해 세션 대신 **JWT(JSON Web Token)** 방식을 많이 사용하기도 하지만, 쿠키와 세션은 웹의 가장 기초적인 상태 관리 기술이므로 반드시 숙지해야 합니다.