# ğŸ“… 2025-12-12 (ê¸ˆ) ë°ì¼ë¦¬ íšŒê³ ë¡
**ğŸ·ï¸ Tags:** #Spring #JPA #ORM #ì—°ê´€ê´€ê³„ë§¤í•‘ #Backend #12ì›”

---

## ğŸ“š í•™ìŠµ ë‚´ìš©
> ì˜¤ëŠ˜ ê³µë¶€í•˜ë©´ì„œ ìƒˆë¡­ê²Œ ë°°ìš´ ë‚´ìš©ì´ë‚˜ ì •ë¦¬í•œ ê°œë…

### 1. ì—°ê´€ê´€ê³„ ë§¤í•‘ì˜ í•„ìš”ì„± (íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜)
- **ê°ì²´ ì§€í–¥ vs ê´€ê³„í˜• DB**: ê°ì²´ëŠ” **ì°¸ì¡°(Reference)** ë¥¼ í†µí•´ ë‹¤ë¥¸ ê°ì²´ì™€ ê´€ê³„ë¥¼ ë§ºì§€ë§Œ, DBëŠ” **ì™¸ë˜ í‚¤(FK)** ë¥¼ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸”ì„ ì¡°ì¸(Join)í•œë‹¤.
- **ë¬¸ì œì **: ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ë°ì´í„° ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ê³„(IDë§Œ ê°€ì§€ê³  ìˆëŠ” í˜•íƒœ)í•˜ë©´, ê°ì²´ ê°„ì˜ í˜‘ë ¥ ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ê³  ëŠì„ì—†ì´ DBë¥¼ ë‹¤ì‹œ ì¡°íšŒí•´ì•¼ í•˜ëŠ” ë¹„íš¨ìœ¨ì´ ë°œìƒí•œë‹¤.
- **í•´ê²°**: ORM(JPA)ì„ ì‚¬ìš©í•˜ì—¬ ê°ì²´ì˜ ì°¸ì¡°ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•¨ìœ¼ë¡œì¨ íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜ë¥¼ í•´ê²°í•œë‹¤.

### 2. ì—°ê´€ê´€ê³„ ë§¤í•‘ ì‹œ í•„ìˆ˜ ê³ ë ¤ 3ìš”ì†Œ
1.  **ë‹¤ì¤‘ì„± (Multiplicity)**: ê´€ê³„ì˜ ìˆ˜ (N:1, 1:N, 1:1, N:M)
2.  **ë°©í–¥ì„± (Direction)**:
    -   **ë‹¨ë°©í–¥**: í•œìª½ì—ì„œë§Œ ì°¸ì¡° (ì˜ˆ: ê²Œì‹œê¸€ -> ì‘ì„±ì)
    -   **ì–‘ë°©í–¥**: ì–‘ìª½ ëª¨ë‘ ì°¸ì¡° (ì˜ˆ: ê²Œì‹œê¸€ <-> ì‘ì„±ì). ì‚¬ì‹¤ìƒ ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë°©í–¥ ê´€ê³„ 2ê°œë‹¤.
3.  **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ (Owner)**: ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ **ì™¸ë˜ í‚¤(FK)ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •)í•˜ëŠ” ì£¼ì²´**.

### 3. ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ê³¼ mappedBy
- **ê·œì¹™**: **ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ì´ ë¬´ì¡°ê±´ ì£¼ì¸(Owner)** ì´ë‹¤.
    -   ì˜ˆ: `Board`(N)ì™€ `Member`(1) ê´€ê³„ì—ì„œ FKëŠ” `BOARD` í…Œì´ë¸”ì— ìˆìœ¼ë¯€ë¡œ `Board.writer`ê°€ ì£¼ì¸ì´ë‹¤.
- **ì£¼ì¸ì˜ ì—­í• **: ì™¸ë˜ í‚¤ ê´€ë¦¬(INSERT, UPDATE).
- **ë¹„ì£¼ì¸(Inverse)ì˜ ì—­í• **: `mappedBy` ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ì£¼ì¸ì„ ì§€ì •. **ì½ê¸° ì „ìš©(Read-only)**ì´ë©° DBì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ.

### 4. ê´€ê³„ ìœ í˜•ë³„ ë§¤í•‘ ì „ëµ ë° ì‹¤ë¬´ ê¶Œì¥ ì‚¬í•­
- **ë‹¤ëŒ€ì¼ (N:1) `[@ManyToOne]`**
    -   **ê°€ì¥ ì¤‘ìš”í•˜ê³  ìì£¼ ì‚¬ìš©ë¨.**
    -   ë°˜ë“œì‹œ **`fetch = FetchType.LAZY` (ì§€ì—° ë¡œë”©)** ë¡œ ì„¤ì •í•˜ì—¬ N+1 ë¬¸ì œë¥¼ ë°©ì§€í•´ì•¼ í•¨.
    -   `@JoinColumn(name = "FK_NAME")`ìœ¼ë¡œ ì™¸ë˜ í‚¤ ë§¤í•‘.
- **ì¼ëŒ€ë‹¤ (1:N) `[@OneToMany]`**
    -   **ê¶Œì¥í•˜ì§€ ì•ŠìŒ (ë‹¨ë°©í–¥ ì‹œ).**
    -   FKê°€ ìƒëŒ€ë°©(Nìª½)ì— ìˆì–´, ë‚´ ì—”í‹°í‹°(1ìª½)ë¥¼ ìˆ˜ì •í–ˆëŠ”ë° ìƒëŒ€ë°© í…Œì´ë¸”ì— UPDATE ì¿¼ë¦¬ê°€ ë‚˜ê°€ëŠ” ë¹„íš¨ìœ¨ ë°œìƒ.
    -   **í•´ê²°**: **ë‹¤ëŒ€ì¼(N:1) ì–‘ë°©í–¥ ë§¤í•‘**ì„ ì‚¬ìš©í•˜ì. (ì½ê¸° ì „ìš©ìœ¼ë¡œ í•„ìš”í•  ë•Œë§Œ ì¶”ê°€)
- **ì¼ëŒ€ì¼ (1:1) `[@OneToOne]`**
    -   ì™¸ë˜ í‚¤ë¥¼ **ì£¼ í…Œì´ë¸”**ì— ë‘ëŠ” ê²ƒì„ ê¶Œì¥ (ê°œë°œ í¸ì˜ì„±, NULL í—ˆìš© ì—¬ë¶€ í™•ì¸ ìš©ì´).
    -   ëŒ€ìƒ í…Œì´ë¸”ì— FKë¥¼ ë‘ë©´ í”„ë¡ì‹œ í•œê³„ë¡œ ì¸í•´ ë¬´ì¡°ê±´ ì¦‰ì‹œ ë¡œë”©(EAGER)ë˜ëŠ” ë‹¨ì ì´ ìˆìŒ.
- **ë‹¤ëŒ€ë‹¤ (N:M) `[@ManyToMany]`**
    -   **ì‹¤ë¬´ ì‚¬ìš© ê¸ˆì§€.**
    -   ì—°ê²° í…Œì´ë¸”ì— ë‹¨ìˆœíˆ IDë§Œ ë“¤ì–´ê°€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì¶”ê°€ ì •ë³´(ë“±ë¡ì¼, ìˆ˜ëŸ‰ ë“±)ê°€ ë“¤ì–´ê°ˆ ìˆ˜ ì—†ê¸° ë•Œë¬¸.
    -   **í•´ê²°**: **ì—°ê²° ì—”í‹°í‹°(ì¤‘ê°„ í…Œì´ë¸”)ë¥¼ ì§ì ‘ ë§Œë“¤ê³ ** `@ManyToOne` ë‘ ê°œë¡œ í’€ì–´ë‚´ì•¼ í•œë‹¤.

### 5. ê¸°íƒ€ ì£¼ìš” ì–´ë…¸í…Œì´ì…˜
- **`@JoinColumn`**: ì™¸ë˜ í‚¤ ì»¬ëŸ¼ëª… ì§€ì • (`name`, `nullable` ë“± ì„¤ì •).
- **`@Enumerated`**: Enum íƒ€ì… ë§¤í•‘ ì‹œ ë°˜ë“œì‹œ **`EnumType.STRING`** ì‚¬ìš© (ORDINAL ì‚¬ìš© ì‹œ ìˆœì„œ ë³€ê²½ë˜ë©´ ë°ì´í„° ê¼¬ì„).

---

## ğŸ§‘ğŸ»â€ğŸ’» ì½”ë“œ ì˜ˆì œ
> ìˆ˜ì—… ì‹œê°„ì— ì‘ì„±í•œ í•µì‹¬ ì½”ë“œë‚˜ ì§ì ‘ ë³€í˜•í•œ ì½”ë“œ

```java
// 1. ë‹¤ëŒ€ì¼(N:1) ì–‘ë°©í–¥ ë§¤í•‘ - ê²Œì‹œê¸€(Board)ê³¼ ì‘ì„±ì(Member)

// [ì£¼ì¸] Board ì—”í‹°í‹°: ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•¨
@Entity
public class Board {
    @Id @GeneratedValue
    private Long boardNo;

    // ì‹¤ë¬´ í•„ìˆ˜: ì§€ì—° ë¡œë”© ì„¤ì •
    @ManyToOne(fetch = FetchType.LAZY) 
    @JoinColumn(name = "BOARD_WRITER") // FK ì»¬ëŸ¼ëª…
    private Member writer;
    
    // ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ (ì–‘ìª½ ë‹¤ ê°’ì„ ì„¸íŒ…í•´ì£¼ê¸° ìœ„í•¨)
    public void setWriter(Member writer) {
        this.writer = writer;
        writer.getBoards().add(this);
    }
}

// [ë¹„ì£¼ì¸] Member ì—”í‹°í‹°: ì½ê¸° ì „ìš©
@Entity
public class Member {
    @Id
    private String userId;

    // mappedByë¡œ ì£¼ì¸ì„ ëª…ì‹œ (Boardì˜ writer í•„ë“œ)
    @OneToMany(mappedBy = "writer") 
    private List<Board> boards = new ArrayList<>();
}
```

```java
// 2. ë‹¤ëŒ€ë‹¤(N:M) í•´ê²° íŒ¨í„´ - ì¤‘ê°„ ì—”í‹°í‹° ì‚¬ìš©

@Entity
public class BoardTag {
    @Id @GeneratedValue
    @Column(name = "BOARD_TAG_ID")
    private Long id;

    @ManyToOne
    @JoinColumn(name = "BOARD_NO")
    private Board board;

    @ManyToOne
    @JoinColumn(name = "TAG_ID")
    private Tag tag;
    
    private LocalDateTime createdAt; // ì¶”ê°€ ì •ë³´ ê´€ë¦¬ ê°€ëŠ¥
}
```

---

## ğŸ’£ Trouble Shooting
> ë°œìƒí•œ ë¬¸ì œì™€ í•´ê²°ì±…

- **ë¬¸ì œ 1: ì–‘ë°©í–¥ ë§¤í•‘ ì‹œ ë°ì´í„°ê°€ ì €ì¥ë˜ì§€ ì•ŠìŒ (FKê°€ NULL)**
    - **ì›ì¸**: ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¸ `Board`ì— ê°’ì„ ë„£ì§€ ì•Šê³ , ì£¼ì¸ì´ ì•„ë‹Œ `Member.boards.add()`ì—ë§Œ ê°’ì„ ë„£ì—ˆê¸° ë•Œë¬¸.
    - **í•´ê²°**: ì™¸ë˜ í‚¤ê°€ ìˆëŠ” **ì£¼ì¸(Owner) ê°ì²´ì— ë°˜ë“œì‹œ ê°’ì„ ì„¤ì •**í•´ì•¼ DBì— ë°˜ì˜ëœë‹¤. (`board.setWriter(member)`)

- **ë¬¸ì œ 2: `StackOverflowError` ë°œìƒ (ë¬´í•œ ë£¨í”„)**
    - **ì›ì¸**: Lombokì˜ `@ToString`ì„ ì–‘ìª½ ì—”í‹°í‹°ì— ëª¨ë‘ ì‚¬ìš©í•˜ë©´ ì„œë¡œë¥¼ ê³„ì† í˜¸ì¶œí•˜ë‹¤ê°€ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•¨. (JSON ë³€í™˜ ì‹œì—ë„ ë™ì¼)
    - **í•´ê²°**: `@ToString(exclude = "fieldName")`ì„ ì‚¬ìš©í•˜ì—¬ ì—°ê´€ê´€ê³„ í•„ë“œë¥¼ ì œì™¸í•˜ê±°ë‚˜, **ì—”í‹°í‹°ë¥¼ ì§ì ‘ ë°˜í™˜í•˜ì§€ ì•Šê³  DTOë¥¼ ì‚¬ìš©í•˜ì—¬ ë°˜í™˜**í•œë‹¤.

---
## ğŸŒŸ ì˜í•œ ì 
> ì˜¤ëŠ˜ í•˜ë£¨ ìŠ¤ìŠ¤ë¡œ ì¹­ì°¬í•  ë§Œí•œ ì 

- ë‹¨ìˆœíˆ ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ë„˜ì–´, **"ì™œ(Why)"** ì—°ê´€ê´€ê³„ ë§¤í•‘ì´ í•„ìš”í•œì§€(íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜)ì™€ **"ì£¼ì¸(Owner)"** ì˜ ê°œë…ì„ ëª…í™•íˆ ì´í•´í•˜ë ¤ê³  ë…¸ë ¥í–ˆë‹¤.
- ì‹¤ë¬´ì—ì„œ ì ˆëŒ€ ì“°ë©´ ì•ˆ ë˜ëŠ” íŒ¨í„´(N:M ì§ì ‘ ë§¤í•‘, EAGER ë¡œë”©)ê³¼ ê¶Œì¥ íŒ¨í„´(N:1 ìœ„ì£¼, LAZY ë¡œë”©)ì„ êµ¬ë¶„í•˜ì—¬ ì •ë¦¬í–ˆë‹¤.

---

## âš ï¸ ì•„ì‰¬ìš´ ì 
> ë¶€ì¡±í–ˆë˜ ì 

- `Cascade` (ì˜ì†ì„± ì „ì´) ì˜µì…˜ê³¼ `orphanRemoval` (ê³ ì•„ ê°ì²´ ì œê±°)ì— ëŒ€í•œ ì‹¤ìŠµì´ ì¡°ê¸ˆ ë¶€ì¡±í–ˆë‹¤. ê²Œì‹œê¸€ ì‚­ì œ ì‹œ ëŒ“ê¸€ì´ ê°™ì´ ì‚­ì œë˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•  ë•Œ ë” ê¹Šê²Œ íŒŒë´ì•¼ê² ë‹¤.

---

## ğŸ¤” ë‚´ì¼ ì‹œë„í•  ì 
> ë‚´ì¼ ì‹œë„í•˜ê³  ì‹¶ì€ ë¶€ë¶„

- ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ê°œì¸ í”„ë¡œì íŠ¸ì˜ ê²Œì‹œíŒ ê¸°ëŠ¥ì—ì„œ **ì‘ì„±ì(Member)ì™€ ê²Œì‹œê¸€(Board), ê²Œì‹œê¸€(Board)ê³¼ ëŒ“ê¸€(Reply)ì˜ ê´€ê³„**ë¥¼ ì‹¤ì œ ì½”ë“œë¡œ êµ¬í˜„í•˜ê³  í…ŒìŠ¤íŠ¸í•´ ë³¼ ê²ƒì´ë‹¤.
- DTOë¥¼ í™œìš©í•˜ì—¬ ì–‘ë°©í–¥ ìˆœí™˜ ì°¸ì¡° ë¬¸ì œë¥¼ ì›ì²œì ìœ¼ë¡œ ì°¨ë‹¨í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§ ì‘ì„±í•˜ê¸°.

---

## ğŸ’¬ í•œì¤„í‰
> ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬

> "ê°ì²´ì™€ DBì˜ ì—°ê²° ê³ ë¦¬, í•µì‹¬ì€ 'ëˆ„ê°€ ì™¸ë˜ í‚¤ë¥¼ ì¥ê³  ìˆëŠ”ê°€(ì£¼ì¸)'ë¥¼ íŒŒì•…í•˜ëŠ” ê²ƒì´ë‹¤."