# ğŸ“… 2025-12-17 (ìˆ˜) ë°ì¼ë¦¬ íšŒê³ ë¡
**ğŸ·ï¸ Tags:** #Spring #JPA #JPQL #NativeQuery #12ì›”

---

## ğŸ“š í•™ìŠµ ë‚´ìš©
> ì˜¤ëŠ˜ ê³µë¶€í•˜ë©´ì„œ ìƒˆë¡­ê²Œ ë°°ìš´ ë‚´ìš©ì´ë‚˜ ì •ë¦¬í•œ ê°œë…

- **ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ (JPQL)**
    - JPAëŠ” ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œí•˜ë¯€ë¡œ, ê²€ìƒ‰(ì¡°íšŒ) í•  ë•Œë„ í…Œì´ë¸”ì´ ì•„ë‹Œ **ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰**í•´ì•¼ í•œë‹¤.
    - SQLì„ ì¶”ìƒí™”í–ˆê¸° ë•Œë¬¸ì— íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - **íŠ¹ì§•**:
        - ëŒ€ì†Œë¬¸ì êµ¬ë¶„: ì—”í‹°í‹°ì™€ ì†ì„±ì€ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•œë‹¤ (ì˜ˆ: `Member`, `username`). JPQL í‚¤ì›Œë“œëŠ” êµ¬ë¶„í•˜ì§€ ì•ŠëŠ”ë‹¤ (ì˜ˆ: `SELECT`, `FROM`).
        - ë³„ì¹­(Alias) í•„ìˆ˜: `select m from Member m` ì²˜ëŸ¼ ë³„ì¹­ì„ ë°˜ë“œì‹œ ì§€ì •í•´ì•¼ í•œë‹¤.

- **ì¿¼ë¦¬ API (TypedQuery vs Query)**
    - **`TypedQuery`**: ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•  ë•Œ ì‚¬ìš©í•œë‹¤. (ì œë„¤ë¦­ ì§€ì›)
    - **`Query`**: ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•˜ì§€ ì•Šê±°ë‚˜ ì—¬ëŸ¬ íƒ€ì…ì´ ì„ì—¬ ìˆì„ ë•Œ ì‚¬ìš©í•œë‹¤.

- **ê²°ê³¼ ì¡°íšŒ API**
    - `getResultList()`: ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì¼ ë•Œ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜. ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜.
    - `getSingleResult()`: ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜ì¼ ë•Œ ë‹¨ì¼ ê°ì²´ ë°˜í™˜.
        - **ì£¼ì˜**: ê²°ê³¼ê°€ ì—†ìœ¼ë©´ `NoResultException`, ë‘˜ ì´ìƒì´ë©´ `NonUniqueResultException` ì˜ˆì™¸ê°€ ë°œìƒí•˜ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•œë‹¤.

- **í”„ë¡œì ì…˜ (Projection)**
    - ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒ (ì—”í‹°í‹°, ì„ë² ë””ë“œ íƒ€ì…, ìŠ¤ì¹¼ë¼ íƒ€ì… ë“±).
    - **DTO ì¡°íšŒ**: `SELECT new com.example.dto.UserDTO(m.username, m.age) FROM Member m` ì²˜ëŸ¼ íŒ¨í‚¤ì§€ëª…ì„ í¬í•¨í•œ ì „ì²´ í´ë˜ìŠ¤ëª…ê³¼ `new` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

- **ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ (Native Query)**
    - JPQLë¡œ í•´ê²°í•  ìˆ˜ ì—†ëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì¢…ì†ì ì¸ ê¸°ëŠ¥(íŠ¹ì • íŒíŠ¸, ë¬¸ë²• ë“±)ì„ ì‚¬ìš©í•  ë•Œ SQLì„ ì§ì ‘ ì‘ì„±í•˜ëŠ” ë°©ì‹.

---

## ğŸ§‘ğŸ»â€ğŸ’» ì½”ë“œ ì˜ˆì œ
> ìˆ˜ì—… ì‹œê°„ì— ì‘ì„±í•œ í•µì‹¬ ì½”ë“œë‚˜ ì§ì ‘ ë³€í˜•í•œ ì½”ë“œ

```java
// 1. ê¸°ë³¸ JPQL ì¡°íšŒ ë° íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
String jpql = "select m from Member m where m.username = :username";
TypedQuery<Member> query = em.createQuery(jpql, Member.class);
query.setParameter("username", "user1"); // ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© (ê¶Œì¥)
List<Member> resultList = query.getResultList();

// 2. DTOë¡œ ì§ì ‘ ì¡°íšŒ (New ëª…ë ¹ì–´ ì‚¬ìš©)
// íŒ¨í‚¤ì§€ ëª…ì„ ë‹¤ ì ì–´ì•¼ í•˜ëŠ” ì ì— ì£¼ì˜!
String dtoJpql = "select new com.example.dto.MemberDto(m.username, m.age) from Member m";
List<MemberDto> resultDTO = em.createQuery(dtoJpql, MemberDto.class).getResultList();

// 3. ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ ì‚¬ìš©
String sql = "SELECT ID, AGE, TEAM_ID, NAME FROM MEMBER WHERE NAME = 'kim'";
List<Object[]> resultNative = em.createNativeQuery(sql).getResultList();
```

---

## ğŸ’£ Trouble Shooting
> ë°œìƒí•œ ë¬¸ì œì™€ í•´ê²°ì±…

- **ë¬¸ì œ**: `getSingleResult()`ë¥¼ ì‚¬ìš©í•´ ë¡œê·¸ì¸ ë¡œì§ì„ êµ¬í˜„í–ˆëŠ”ë°, IDê°€ í‹€ë ¤ì„œ ê²°ê³¼ê°€ ì—†ìœ¼ë‹ˆ `NoResultException`ì´ í„°ì§€ë©´ì„œ ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí•¨.
- **í•´ê²°**: `getSingleResult()`ëŠ” ê²°ê³¼ê°€ 0ê°œì´ê±°ë‚˜ 2ê°œ ì´ìƒì´ë©´ ë¬´ì¡°ê±´ ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤. ê²°ê³¼ê°€ ì—†ì„ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ë¡œì§ì—ì„œëŠ” `getResultList()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬ìŠ¤íŠ¸ ì‚¬ì´ì¦ˆë¥¼ ì²´í¬í•˜ê±°ë‚˜, Spring Data JPAì˜ `Optional` ë°˜í™˜ì„ í™œìš©í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤.

---
## ğŸŒŸ ì˜í•œ ì 
> ì˜¤ëŠ˜ í•˜ë£¨ ìŠ¤ìŠ¤ë¡œ ì¹­ì°¬í•  ë§Œí•œ ì 

- SQLê³¼ ë¹„ìŠ·í•´ ë³´ì´ì§€ë§Œ ì—”í‹°í‹°ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•œë‹¤ëŠ” JPQLì˜ í•µì‹¬ ì°¨ì´ë¥¼ ì´í•´í•˜ê³ , íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì‹œ ìœ„ì¹˜ ê¸°ë°˜(`?1`)ë³´ë‹¤ ì´ë¦„ ê¸°ë°˜(`:name`)ì´ ìœ ì§€ë³´ìˆ˜ì— ì¢‹ë‹¤ëŠ” ì ì„ í™•ì‹¤íˆ ì§šê³  ë„˜ì–´ê°”ë‹¤.

---

## âš ï¸ ì•„ì‰¬ìš´ ì 
> ë¶€ì¡±í–ˆë˜ ì 

- JPQLì„ ë¬¸ìì—´ë¡œ ì‘ì„±í•˜ë‹¤ ë³´ë‹ˆ ì˜¤íƒ€ê°€ ë‚˜ë©´ ì‹¤í–‰ ì‹œì (Runtime)ì— ì—ëŸ¬ë¥¼ ë°œê²¬í•˜ê²Œ ëœë‹¤. ë™ì  ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ë•Œë„ ë¬¸ìì—´ ë”í•˜ê¸° ë°©ì‹ì€ ë„ˆë¬´ ë³µì¡í•˜ê³  ìœ„í—˜í•´ ë³´ì¸ë‹¤.

---

## ğŸ¤” ë‚´ì¼ ì‹œë„í•  ì 
> ë‚´ì¼ ì‹œë„í•˜ê³  ì‹¶ì€ ë¶€ë¶„

- ë¬¸ìì—´ í˜•íƒœì¸ JPQLì˜ ë‹¨ì ì„ ë³´ì™„í•´ì¤„ ìˆ˜ ìˆëŠ” **QueryDSL**ì— ëŒ€í•´ ì•Œì•„ë³´ê³ , ìë°” ì½”ë“œë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ì„ ë§›ë³´ê³  ì‹¶ë‹¤.

---

## ğŸ’¬ í•œì¤„í‰
> ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬

> "JPQLì€ ê°ì²´ì§€í–¥ê³¼ SQL ì‚¬ì´ì˜ í†µì—­ì‚¬! í•˜ì§€ë§Œ ë¬¸ìì—´ ì˜¤íƒ€ëŠ” í•­ìƒ ì¡°ì‹¬í•˜ì."